---
knit: ({source(here::here("tools/knit.R")); knit_man_src})
---
Computes the Intersection-Over-Union metric for specific target classes.

@description
Formula:

```{r, eval=FALSE}
iou <- true_positives / (true_positives + false_positives + false_negatives)
```
Intersection-Over-Union is a common evaluation metric for semantic image
segmentation.

To compute IoUs, the predictions are accumulated in a confusion matrix,
weighted by `sample_weight` and the metric is then calculated from it.

If `sample_weight` is `NULL`, weights default to 1.
Use `sample_weight` of 0 to mask values.

Note, this class first computes IoUs for all individual classes, then
returns the mean of IoUs for the classes that are specified by
`target_class_ids`. If `target_class_ids` has only one id value, the IoU of
that specific class is returned.

# Examples
Standalone usage:

```{r}
m <- metric_iou(num_classes = 2L, target_class_ids = list(0L))
m$update_state(c(0, 0, 1, 1), c(0, 1, 0, 1))
m$result()
```

```{r}
m$reset_state()
m$update_state(c(0, 0, 1, 1), c(0, 1, 0, 1),
               sample_weight = c(0.3, 0.3, 0.3, 0.1))
m$result()
```

Usage with `compile()` API:

```{r, eval=FALSE}
model %>% compile(
  optimizer = 'sgd',
  loss = 'mse',
  metrics = list(metric_iou(num_classes = 2L, target_class_ids = list(0L))))
```

@param num_classes
The possible number of labels the prediction task can have.

@param target_class_ids
A list of target class ids for which the
metric is returned. To compute IoU for a specific class, a list
of a single id value should be provided.

@param name
(Optional) string name of the metric instance.

@param dtype
(Optional) data type of the metric result.

@param ignore_class
Optional integer. The ID of a class to be ignored during
metric computation. This is useful, for example, in segmentation
problems featuring a "void" class (commonly -1 or 255) in
segmentation maps. By default (`ignore_class=NULL`), all classes are
  considered.

@param sparse_y_true
Whether labels are encoded using integers or
dense floating point vectors. If `FALSE`, the `argmax` function
is used to determine each sample's most likely associated label.

@param sparse_y_pred
Whether predictions are encoded using integers or
dense floating point vectors. If `FALSE`, the `argmax` function
is used to determine each sample's most likely associated label.

@param axis
(Optional) -1 is the dimension containing the logits.
Defaults to `-1`.

@param ...
Passed on to the Python callable

@export
@family iou metrics
@family metrics
@seealso
+ <https://www.tensorflow.org/api_docs/python/tf/keras/metrics/IoU>

