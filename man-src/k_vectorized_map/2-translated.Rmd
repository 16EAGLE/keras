---
knit: ({source(here::here("tools/knit.R")); knit_man_src})
---
Parallel map of `function` on axis 0 of tensor(s) `elements`.

@description
Schematically, `vectorized_map` implements the following,
in the case of a single tensor input `elements`:

```{r, eval = FALSE}
k_vectorized_map <- function(elements, f) {
  apply(elements, 1, f)
}
```

In the case of an iterable of tensors `elements`,
it implements the following:

```{r, eval = FALSE}
k_vectorized_map <- function(elements, f) {
    batch_size <- elements[[1]]$shape[[1]]
    outputs <- vector("list", batch_size)
    outputs <- lapply(seq(batch_size), \(index) {
        f(lapply(elements, \(e) e[index, all_dims()]))
    }
    k_stack(outputs)
}
```

In this case, `function` is expected to take as input
a single list of tensor arguments.


```{r}
(x <- k_arange(4*4) |> k_reshape(c(4,4)))
x |> k_vectorized_map(\(row) {row + 10})
list(x, x, x) |> k_vectorized_map(\(rows) Reduce(`+`, rows))
```

@param elements
see description

@param f
A function taking either a tensor, or list of tensors.

@export
@family core ops
@family ops
@seealso
+ <https://www.tensorflow.org/api_docs/python/tf/keras/ops/vectorized_map>

