<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Few-shot classification on the Omniglot dataset using Reptile.">
<title>Few-Shot learning with Reptile • keras3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/Fira_Code-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Few-Shot learning with Reptile">
<meta property="og:description" content="Few-shot classification on the Omniglot dataset using Reptile.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">keras3</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.13.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../index.html">Home</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting Started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../../articles/intro_to_keras_for_engineers.html">Introduction to Keras for engineers</a>
    <h6 class="dropdown-header" data-toc-skip>Tutorials</h6>
    <a class="dropdown-item" href="../../articles/getting_started.html">Getting Started</a>
    <a class="dropdown-item" href="../../articles/tutorial_basic_classification.html">Basic Classification</a>
    <a class="dropdown-item" href="../../articles/tutorial_basic_text_classification.html">Text Classification</a>
    <a class="dropdown-item" href="../../articles/tutorial_basic_regression.html">Basic Regression</a>
    <a class="dropdown-item" href="../../articles/tutorial_overfit_underfit.html">Overfitting and Underfitting</a>
    <a class="dropdown-item" href="../../articles/tutorial_save_and_restore.html">Save and Restore Models</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <h6 class="dropdown-header" data-toc-skip>Model definition</h6>
    <a class="dropdown-item" href="../../articles/functional_api.html">Functional API</a>
    <a class="dropdown-item" href="../../articles/sequential_model.html">Sequential Model</a>
    <h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6>
    <a class="dropdown-item" href="../../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a>
    <a class="dropdown-item" href="../../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a>
    <a class="dropdown-item" href="../../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a>
    <a class="dropdown-item" href="../../articles/writing_your_own_callbacks.html">Writing Your Own Callbacks</a>
    <h6 class="dropdown-header" data-toc-skip>Other topics</h6>
    <a class="dropdown-item" href="../../articles/transfer_learning.html">Transfer learning and fine tuning</a>
    <a class="dropdown-item" href="../../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../../articles/examples/index.html">Examples</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rstudio/keras/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Few-Shot learning with Reptile</h1>
                        <h4 data-toc-skip class="author"><a href="https://github.com/ADMoreau" class="external-link">ADMoreau</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras/blob/HEAD/vignettes/examples/reptile.Rmd" class="external-link"><code>vignettes/examples/reptile.Rmd</code></a></small>
      <div class="d-none name"><code>reptile.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://arxiv.org/abs/1803.02999" class="external-link">Reptile</a> algorithm
was developed by OpenAI to perform model-agnostic meta-learning.
Specifically, this algorithm was designed to quickly learn to perform
new tasks with minimal training (few-shot learning). The algorithm works
by performing Stochastic Gradient Descent using the difference between
weights trained on a mini-batch of never-seen-before data and the model
weights prior to training over a fixed number of meta-iterations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>os.environ[<span class="st">"KERAS_BACKEND"</span>] <span class="op">=</span> <span class="st">"tensorflow"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">import</span> keras <span class="im">as</span> keras</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> layers</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="im">import</span> tensorflow_datasets <span class="im">as</span> tfds</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="define-the-hyperparameters">Define the Hyperparameters<a class="anchor" aria-label="anchor" href="#define-the-hyperparameters"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">0.003</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>meta_step_size <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>inner_batch_size <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>eval_batch_size <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>meta_iters <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>eval_iters <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>inner_iters <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>eval_interval <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>train_shots <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>shots <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>classes <span class="op">=</span> <span class="dv">5</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-the-data">Prepare the data<a class="anchor" aria-label="anchor" href="#prepare-the-data"></a>
</h2>
<p>The <a href="https://github.com/brendenlake/omniglot/" class="external-link">Omniglot
dataset</a> is a dataset of 1,623 characters taken from 50 different
alphabets, with 20 examples for each character. The 20 samples for each
character were drawn online via Amazon’s Mechanical Turk. For the
few-shot learning task, <code>k</code> samples (or “shots”) are drawn
randomly from <code>n</code> randomly-chosen classes. These
<code>n</code> numerical values are used to create a new set of
temporary labels to use to test the model’s ability to learn a new task
given few examples. In other words, if you are training on 5 classes,
your new class labels will be either 0, 1, 2, 3, or 4. Omniglot is a
great dataset for this task since there are many different classes to
draw from, with a reasonable number of samples for each class.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">class</span> Dataset:</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="co"># This class will facilitate the creation of a few-shot dataset</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="co"># from the Omniglot dataset that can be sampled from quickly while also</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="co"># allowing to create new labels at the same time.</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, training):</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        <span class="co"># Download the tfrecord files containing the omniglot data and convert to a</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        <span class="co"># dataset.</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        split <span class="op">=</span> <span class="st">"train"</span> <span class="cf">if</span> training <span class="cf">else</span> <span class="st">"test"</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>        ds <span class="op">=</span> tfds.load(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>            <span class="st">"omniglot"</span>, split<span class="op">=</span>split, as_supervised<span class="op">=</span><span class="va">True</span>, shuffle_files<span class="op">=</span><span class="va">False</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        )</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="co"># Iterate over the dataset to get each individual image and its class,</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>        <span class="co"># and put that data into a dictionary.</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> {}</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>        <span class="kw">def</span> extraction(image, label):</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>            <span class="co"># This function will shrink the Omniglot images to the desired size,</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>            <span class="co"># scale pixel values and convert the RGB image to grayscale</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>            image <span class="op">=</span> tf.image.convert_image_dtype(image, tf.float32)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>            image <span class="op">=</span> tf.image.rgb_to_grayscale(image)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>            image <span class="op">=</span> tf.image.resize(image, [<span class="dv">28</span>, <span class="dv">28</span>])</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>            <span class="cf">return</span> image, label</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>        <span class="cf">for</span> image, label <span class="kw">in</span> ds.<span class="bu">map</span>(extraction):</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>            image <span class="op">=</span> image.numpy()</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>            label <span class="op">=</span> <span class="bu">str</span>(label.numpy())</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>            <span class="cf">if</span> label <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.data:</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>                <span class="va">self</span>.data[label] <span class="op">=</span> []</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>            <span class="va">self</span>.data[label].append(image)</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>        <span class="va">self</span>.labels <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.data.keys())</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="kw">def</span> get_mini_dataset(</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>        <span class="va">self</span>, batch_size, repetitions, shots, num_classes, split<span class="op">=</span><span class="va">False</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    ):</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>        temp_labels <span class="op">=</span> np.zeros(shape<span class="op">=</span>(num_classes <span class="op">*</span> shots))</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>        temp_images <span class="op">=</span> np.zeros(shape<span class="op">=</span>(num_classes <span class="op">*</span> shots, <span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>))</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>        <span class="cf">if</span> split:</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>            test_labels <span class="op">=</span> np.zeros(shape<span class="op">=</span>(num_classes))</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>            test_images <span class="op">=</span> np.zeros(shape<span class="op">=</span>(num_classes, <span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>))</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>        <span class="co"># Get a random subset of labels from the entire label set.</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>        label_subset <span class="op">=</span> random.choices(<span class="va">self</span>.labels, k<span class="op">=</span>num_classes)</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>        <span class="cf">for</span> class_idx, class_obj <span class="kw">in</span> <span class="bu">enumerate</span>(label_subset):</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>            <span class="co"># Use enumerated index value as a temporary label for mini-batch in</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>            <span class="co"># few shot learning.</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>            temp_labels[class_idx <span class="op">*</span> shots : (class_idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> shots] <span class="op">=</span> class_idx</span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>            <span class="co"># If creating a split dataset for testing, select an extra sample from each</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>            <span class="co"># label to create the test dataset.</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>            <span class="cf">if</span> split:</span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>                test_labels[class_idx] <span class="op">=</span> class_idx</span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>                images_to_split <span class="op">=</span> random.choices(</span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>                    <span class="va">self</span>.data[label_subset[class_idx]], k<span class="op">=</span>shots <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>                )</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>                test_images[class_idx] <span class="op">=</span> images_to_split[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>                temp_images[</span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>                    class_idx <span class="op">*</span> shots : (class_idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> shots</span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>                ] <span class="op">=</span> images_to_split[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>                <span class="co"># For each index in the randomly selected label_subset, sample the</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>                <span class="co"># necessary number of images.</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>                temp_images[</span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>                    class_idx <span class="op">*</span> shots : (class_idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> shots</span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>                ] <span class="op">=</span> random.choices(<span class="va">self</span>.data[label_subset[class_idx]], k<span class="op">=</span>shots)</span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>        dataset <span class="op">=</span> tf.data.Dataset.from_tensor_slices(</span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a>            (temp_images.astype(np.float32), temp_labels.astype(np.int32))</span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>        )</span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>        dataset <span class="op">=</span> dataset.shuffle(<span class="dv">100</span>).batch(batch_size).repeat(repetitions)</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>        <span class="cf">if</span> split:</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>            <span class="cf">return</span> dataset, test_images, test_labels</span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>        <span class="cf">return</span> dataset</span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a><span class="im">import</span> urllib3</span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a>urllib3.disable_warnings()  <span class="co"># Disable SSL warnings that may happen during download.</span></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>train_dataset <span class="op">=</span> Dataset(training<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>test_dataset <span class="op">=</span> Dataset(training<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-some-examples-from-the-dataset">Visualize some examples from the dataset<a class="anchor" aria-label="anchor" href="#visualize-some-examples-from-the-dataset"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>_, axarr <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">5</span>, ncols<span class="op">=</span><span class="dv">5</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>sample_keys <span class="op">=</span> <span class="bu">list</span>(train_dataset.data.keys())</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="cf">for</span> b <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        temp_image <span class="op">=</span> train_dataset.data[sample_keys[a]][b]</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>        temp_image <span class="op">=</span> np.stack((temp_image[:, :, <span class="dv">0</span>],) <span class="op">*</span> <span class="dv">3</span>, axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        temp_image <span class="op">*=</span> <span class="dv">255</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        temp_image <span class="op">=</span> np.clip(temp_image, <span class="dv">0</span>, <span class="dv">255</span>).astype(<span class="st">"uint8"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>        <span class="cf">if</span> b <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>            axarr[a, b].set_title(<span class="st">"Class : "</span> <span class="op">+</span> sample_keys[a])</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>        axarr[a, b].imshow(temp_image, cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>        axarr[a, b].xaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>        axarr[a, b].yaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-the-model">Build the model<a class="anchor" aria-label="anchor" href="#build-the-model"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> conv_bn(x):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv2D(filters<span class="op">=</span><span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, strides<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="st">"same"</span>)(x)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    x <span class="op">=</span> layers.BatchNormalization()(x)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="cf">return</span> layers.ReLU()(x)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>inputs <span class="op">=</span> layers.Input(shape<span class="op">=</span>(<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>x <span class="op">=</span> conv_bn(inputs)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>x <span class="op">=</span> conv_bn(x)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>x <span class="op">=</span> conv_bn(x)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>x <span class="op">=</span> conv_bn(x)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>x <span class="op">=</span> layers.Flatten()(x)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>outputs <span class="op">=</span> layers.Dense(classes, activation<span class="op">=</span><span class="st">"softmax"</span>)(x)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>model <span class="op">=</span> keras.Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>model.<span class="bu">compile</span>()</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>optimizer <span class="op">=</span> keras.optimizers.SGD(learning_rate<span class="op">=</span>learning_rate)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="train-the-model">Train the model<a class="anchor" aria-label="anchor" href="#train-the-model"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>training <span class="op">=</span> []</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>testing <span class="op">=</span> []</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="cf">for</span> meta_iter <span class="kw">in</span> <span class="bu">range</span>(meta_iters):</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    frac_done <span class="op">=</span> meta_iter <span class="op">/</span> meta_iters</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    cur_meta_step_size <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> frac_done) <span class="op">*</span> meta_step_size</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="co"># Temporarily save the weights from the model.</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    old_vars <span class="op">=</span> model.get_weights()</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="co"># Get a sample from the full dataset.</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    mini_dataset <span class="op">=</span> train_dataset.get_mini_dataset(</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>        inner_batch_size, inner_iters, train_shots, classes</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    )</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="cf">for</span> images, labels <span class="kw">in</span> mini_dataset:</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>        <span class="cf">with</span> tf.GradientTape() <span class="im">as</span> tape:</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>            preds <span class="op">=</span> model(images)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>            loss <span class="op">=</span> keras.losses.sparse_categorical_crossentropy(labels, preds)</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>        grads <span class="op">=</span> tape.gradient(loss, model.trainable_weights)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>        optimizer.apply_gradients(<span class="bu">zip</span>(grads, model.trainable_weights))</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    new_vars <span class="op">=</span> model.get_weights()</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>    <span class="co"># Perform SGD for the meta step.</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(new_vars)):</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        new_vars[var] <span class="op">=</span> old_vars[var] <span class="op">+</span> (</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>            (new_vars[var] <span class="op">-</span> old_vars[var]) <span class="op">*</span> cur_meta_step_size</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>        )</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>    <span class="co"># After the meta-learning step, reload the newly-trained weights into the model.</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>    model.set_weights(new_vars)</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>    <span class="co"># Evaluation loop</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>    <span class="cf">if</span> meta_iter <span class="op">%</span> eval_interval <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>        accuracies <span class="op">=</span> []</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>        <span class="cf">for</span> dataset <span class="kw">in</span> (train_dataset, test_dataset):</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>            <span class="co"># Sample a mini dataset from the full dataset.</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>            train_set, test_images, test_labels <span class="op">=</span> dataset.get_mini_dataset(</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>                eval_batch_size, eval_iters, shots, classes, split<span class="op">=</span><span class="va">True</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>            )</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>            old_vars <span class="op">=</span> model.get_weights()</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>            <span class="co"># Train on the samples and get the resulting accuracies.</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>            <span class="cf">for</span> images, labels <span class="kw">in</span> train_set:</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>                <span class="cf">with</span> tf.GradientTape() <span class="im">as</span> tape:</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>                    preds <span class="op">=</span> model(images)</span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>                    loss <span class="op">=</span> keras.losses.sparse_categorical_crossentropy(</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>                        labels, preds</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>                    )</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>                grads <span class="op">=</span> tape.gradient(loss, model.trainable_weights)</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>                optimizer.apply_gradients(<span class="bu">zip</span>(grads, model.trainable_weights))</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>            test_preds <span class="op">=</span> model.predict(test_images)</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>            test_preds <span class="op">=</span> tf.argmax(test_preds).numpy()</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a>            num_correct <span class="op">=</span> (test_preds <span class="op">==</span> test_labels).<span class="bu">sum</span>()</span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a>            <span class="co"># Reset the weights after getting the evaluation accuracies.</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>            model.set_weights(old_vars)</span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>            accuracies.append(num_correct <span class="op">/</span> classes)</span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a>        training.append(accuracies[<span class="dv">0</span>])</span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>        testing.append(accuracies[<span class="dv">1</span>])</span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>        <span class="cf">if</span> meta_iter <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a>            <span class="bu">print</span>(</span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a>                <span class="st">"batch </span><span class="sc">%d</span><span class="st">: train=</span><span class="sc">%f</span><span class="st"> test=</span><span class="sc">%f</span><span class="st">"</span></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a>                <span class="op">%</span> (meta_iter, accuracies[<span class="dv">0</span>], accuracies[<span class="dv">1</span>])</span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a>            )</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-results">Visualize Results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># First, some preprocessing to smooth the training and testing arrays for display.</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>window_length <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>train_s <span class="op">=</span> np.r_[</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    training[window_length <span class="op">-</span> <span class="dv">1</span> : <span class="dv">0</span> : <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    training,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    training[<span class="op">-</span><span class="dv">1</span>:<span class="op">-</span>window_length:<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>]</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>test_s <span class="op">=</span> np.r_[</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    testing[window_length <span class="op">-</span> <span class="dv">1</span> : <span class="dv">0</span> : <span class="op">-</span><span class="dv">1</span>], testing, testing[<span class="op">-</span><span class="dv">1</span>:<span class="op">-</span>window_length:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>]</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>w <span class="op">=</span> np.hamming(window_length)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>train_y <span class="op">=</span> np.convolve(w <span class="op">/</span> w.<span class="bu">sum</span>(), train_s, mode<span class="op">=</span><span class="st">"valid"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>test_y <span class="op">=</span> np.convolve(w <span class="op">/</span> w.<span class="bu">sum</span>(), test_s, mode<span class="op">=</span><span class="st">"valid"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co"># Display the training accuracies.</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="bu">len</span>(test_y), <span class="dv">1</span>)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>plt.plot(x, test_y, x, train_y)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>plt.legend([<span class="st">"test"</span>, <span class="st">"train"</span>])</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>plt.grid()</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>train_set, test_images, test_labels <span class="op">=</span> dataset.get_mini_dataset(</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    eval_batch_size, eval_iters, shots, classes, split<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>)</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="cf">for</span> images, labels <span class="kw">in</span> train_set:</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="cf">with</span> tf.GradientTape() <span class="im">as</span> tape:</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>        preds <span class="op">=</span> model(images)</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>        loss <span class="op">=</span> keras.losses.sparse_categorical_crossentropy(labels, preds)</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    grads <span class="op">=</span> tape.gradient(loss, model.trainable_weights)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>    optimizer.apply_gradients(<span class="bu">zip</span>(grads, model.trainable_weights))</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>test_preds <span class="op">=</span> model.predict(test_images)</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>test_preds <span class="op">=</span> tf.argmax(test_preds).numpy()</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>_, axarr <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">5</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>sample_keys <span class="op">=</span> <span class="bu">list</span>(train_dataset.data.keys())</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="dv">5</span>), axarr):</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>    temp_image <span class="op">=</span> np.stack((test_images[i, :, :, <span class="dv">0</span>],) <span class="op">*</span> <span class="dv">3</span>, axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>    temp_image <span class="op">*=</span> <span class="dv">255</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>    temp_image <span class="op">=</span> np.clip(temp_image, <span class="dv">0</span>, <span class="dv">255</span>).astype(<span class="st">"uint8"</span>)</span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>    ax.set_title(</span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>        <span class="st">"Label : </span><span class="sc">{}</span><span class="st">, Prediction : </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(test_labels[i]), test_preds[i])</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>    )</span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>    ax.imshow(temp_image, cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>    ax.xaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>    ax.yaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
